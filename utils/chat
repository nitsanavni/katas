#!/bin/bash

MODEL="gpt-4"
API_URL="https://api.openai.com/v1/chat/completions"

while getopts ":3" opt; do
  case $opt in
    3)
      MODEL="gpt-3.5-turbo"
      ;;
    \?)
      echo "Invalid option: -$OPTARG" >&2
      exit 1
      ;;
  esac
done
shift $((OPTIND -1))

USER_MESSAGE="$*"

JSON_SAFE_MESSAGE=$(echo -n "$USER_MESSAGE" | jq -Rs)

read -r -d '' PAYLOAD <<- EOM
{
   "model": "$MODEL",
   "messages": [
      {"role": "user", "content": $JSON_SAFE_MESSAGE}
   ]
}
EOM

RESPONSE=$(curl -sS "$API_URL" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $OPENAI_API_KEY" \
  --data "$PAYLOAD")

echo "$RESPONSE" | jq -r '(.choices[0].message.content,.error.message)//empty'
